var _=Object.defineProperty;var u=Object.getOwnPropertySymbols;var m=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var c=(o,s,l)=>s in o?_(o,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[s]=l,f=(o,s)=>{for(var l in s||(s={}))m.call(s,l)&&c(o,l,s[l]);if(u)for(var l of u(s))A.call(s,l)&&c(o,l,s[l]);return o};(function(o,s){typeof exports=="object"&&typeof module!="undefined"?module.exports=s():typeof define=="function"&&define.amd?define(s):(o=typeof globalThis!="undefined"?globalThis:o||self,o.JsonapiNormalizer=s())})(this,function(){"use strict";class o{static transform(e){let{data:t,included:r,meta:i,links:a}=e,p={};return Array.isArray(t)?p=t.map(d=>s(d,r)):p=s(t,r),{data:p,meta:i,links:a}}}function s(n,e){if(!n)return{};let t=f({id:n.id},n.attributes);if(n.relationships){let r=Object.keys(n.relationships).map(a=>({property:a,data:n.relationships[a].data})).filter(a=>!Array.isArray(a.data)||a.data.length>0),i=l(e,r);Object.keys(i).forEach(a=>{t[a]=i[a]})}return t}function l(n,e){let t=y(n),r={};return Object.keys(e).forEach(i=>{if(Array.isArray(e[i].data))e[i].data.forEach(a=>{let p=a.type+"_"+a.id;r[e[i].property]||(r[e[i].property]=[]),r[e[i].property].push(t[p]),h(p,t)});else{let a=e[i].data.type+"_"+e[i].data.id;r[e[i].property]=t[a],h(a,t)}}),r}function h(n,e){let t=e[n];t._relationships&&(Object.keys(t._relationships).forEach(r=>{if(Array.isArray(t._relationships[r]))t[r]=[],t._relationships[r].forEach(i=>{t[r].push(e[i])});else{let i=t._relationships[r];t[r]=e[i]}}),delete t._relationships)}function y(n){let e={};for(let t=0;t<n.length;t++){let r=n[t],i=r.type+"_"+r.id;e[i]=f({id:r.id},r.attributes),r.relationships&&Object.keys(r.relationships).forEach(a=>{let p=r.relationships[a].data;e[i]._relationships=e[i]._relationships||{},Array.isArray(p)?(e[i]._relationships[a]=[],p.forEach(d=>{e[i]._relationships[a].push(d.type+"_"+d.id)})):e[i]._relationships[a]=p.type+"_"+p.id})}return e}return o});
